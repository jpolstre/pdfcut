"use strict";function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mainStart(){var e,t=!0,n={cards:[],loading:!1,btnText:"Eliminar Seleccionadas",downloadable:!1,modal:!1,currentSelected:null,message:"",file:{name:"",dir:"",numPages:0,size:0}};new Vue({el:"#app",data:_objectSpread({},n),mounted:function(){var e=this;document.getElementById("submit").addEventListener("click",this.onSubmit),document.body.style.overflow="auto",window.addEventListener("beforeunload",function(t){return e.onUnloadHandler(t)}),window.performance,performance.navigation.type==performance.navigation.TYPE_RELOAD&&sessionStorage.removeItem("data"),this.initData()},watch:{loading:function(e,t){document.body.style.overflow=e?"hidden":"auto"},modal:function(e,t){document.body.style.overflow=e?"hidden":"auto"}},computed:{numCardsSelected:function(){return this.cards&&this.cards.filter(function(e){return e.selected}).length||0},subTiTle:function(){return this.cards.length>0?"Selecciona las paginas que deseas eliminar":"Carga un documento pdf"}},methods:{onUnloadHandler:function(n){if(t){var a=document.getElementById("my-form-post"),i=new FormData(a);e&&e.abort(),navigator.sendBeacon("/Index?handler=RemoveDirectory",i)}},initData:function(){var e=document.getElementById("loader");e.classList.add("text-loader-fadeOut");var t,a=setTimeout(function(){e.style.display="none",clearTimeout(a)}),i=sessionStorage.getItem("data");for(var o in t=i?JSON.parse(i):n)this[o]=t[o]},selectPage:function(e){this.loading||this.cards.length<2||(this.cards.length<2?this.message="No se puede eliminar la única pagina":(this.cards.length-this.numCardsSelected<2&&(this.message="no se pueden eliminar todas las paginas, por lo menos deja una."),(this.cards.length-this.numCardsSelected>1||this.cards[e].selected)&&(this.cards[e].selected=!this.cards[e].selected,this.message="")))},clearSelected:function(){for(var e=0;e<this.cards.length;e++)this.cards[e].selected=!1},onDeleted:function(){var e=this;if(0!==this.numCardsSelected){var t=document.getElementById("loader2");t.style.height=document.body.scrollHeight+120+"px",t.classList.remove("fade-out-loader"),this.loading=!0,this.message="Eliminando pagina..";var n=setTimeout(function(){var a=e.cards.reduce(function(e,t){return t.selected||e.push(t.id+1),e},[]).join(",");fetch("/Index?handler=DeletePages&directory="+e.file.dir+"&pagesString="+a).then(function(e){return e.json()}).then(function(n){if(t.classList.add("fade-out-loader"),n.status){var a=0;e.cards=e.cards.reduce(function(e,t){return t.selected||e.push(_objectSpread(_objectSpread({},t),{},{id:a++})),e},[]),e.downloadable=!0,e.message=n.message}var i=setTimeout(function(){clearTimeout(i),e.loading=!1;var t=setTimeout(function(){e.message="",clearTimeout(t)},4e3)},500)}),clearTimeout(n)},100)}else this.message="selecciona paginas para eliminar!"},onDownload:function(){t=!1,window.location="/Index?handler=Download&dir="+this.file.dir+"&pdfName="+this.file.name,t=!0},reset:function(){e&&e.abort();var t=setTimeout(function(){clearTimeout(t),location.reload()},500)},onClickSelectFile:function(){document.getElementById("inputFile").click()},validateInputFile:function(){var e={message:"",size:0,name:"",isValid:!1};if(!window.FileReader)return e.message="The file API isn't supported on this browser yet.",e;var t=document.getElementById("inputFile");return t.files?t.files[0]?t.files[0].size>3e7?(e.message="Solo se permiten archivos menores a 30 Mb.!!",e):"application/pdf"!==t.files[0].type?(e.message="Solo puedes elegir archivos PDF",e):(e.isValid=!0,e.name=t.files[0].name,e.size=Math.round(t.files[0].size/1e6)+" Mb.",e):(e.message="Selecciona un archivo pdf",e):(e.message="This browser doesn't seem to support the `files` property of file inputs.",e)},onSubmit:function(t){var n=this;t.preventDefault(),this.loading=!0;var a=this.validateInputFile();if(!a.isValid)return this.loading=!1,void(this.message=a.message);e=new AbortController,this.message="Cargando "+a.name+" ("+a.size+") ...ten paciencia";var i=new FormData(document.forms[0]);fetch("/Index?handler=UploadFilePdf",{method:"post",body:i,signal:e.signal}).then(function(e){return e.json()}).then(function(t){n.loading=!1,t.status?(n.loading=!0,n.message="Generando la vista para: "+a.name+" ("+t.payload.numPages+" paginas) ...ten paciencia",n.file.name=t.payload.name,n.file.dir=t.payload.dir,n.file.numPages=t.payload.numPages,fetch("/Index?handler=MakeImages&nameDir="+n.file.dir,{signal:e.signal}).then(function(e){return e.json()}).then(function(e){n.loading=!1,e.status?(n.message="No olvides limpiar tu area de trabajo cuando termines",e.payload.forEach(function(e){n.cards.push(_objectSpread(_objectSpread({},e),{},{selected:!1}))})):n.message=e.message})):(n.loading=!1,n.message=t.message)})},uploadFile:function(){document.getElementById("submit").click()},closeAlert:function(e){this.message=""},zoomPage:function(e,t){e.preventDefault(),e.stopPropagation(),this.currentSelected=this.cards[t],this.modal=!0},toggleSelectImage:function(){this.currentSelected.selected=!this.currentSelected.selected}},destroyed:function(){var e=this;document.getElementById("submit").removeEventListener("click",this.onSubmit),window.removeEventListener("beforeunload",function(t){return e.onUnloadHandler(t)})}})}window.addEventListener("load",function(){var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/vue@2",document.body.appendChild(e),e.addEventListener("load",function(){var t=document.createElement("script");e.src2="https://unpkg.com/navigator.sendbeacon",document.body.appendChild(t),mainStart()})});